
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Reshaping with pivot_table &#8212; Programming in Python for Data Science</title>
    
  <link href="../../_static/css/theme.css" rel="stylesheet" />
  <link href="../../_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="../../_static/sphinx-book-theme.e8f53015daec13862f6db5e763c41738.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/extras.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="../../_static/js/index.1c5a1a01449ed65a7b51.js">

    <script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/togglebutton.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script >var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script >
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <link rel="canonical" href="gifted-perlman-a442ef.netlify.app/modules/module3/module3_11.html" />
    <link rel="shortcut icon" href="../../_static/icon.png"/>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
      <img src="../../_static/logo.svg" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Programming in Python for Data Science</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p class="caption">
 <span class="caption-text">
  Modules
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module1.html">
   Module 1:  Python &amp; Pandas - An Unexpected Friendship
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-1" name="toctree-checkbox-1" type="checkbox"/>
  <label for="toctree-checkbox-1">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_01.html">
     What is a dataframe?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_03.html">
     What is Pandas?
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_07.html">
     Slicing Rows using .loc[]
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_11.html">
     Slicing only columns using .loc[]
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_13.html">
     Selecting using .loc[]
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_16.html">
     Obtaining dataframe values
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_18.html">
     Selecting a Single Column
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_20.html">
     Slicing and selecting using .iloc[]
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_24.html">
     Sorting dataframes
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_26.html">
     Summary Statistics
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_29.html">
     Frequency Tables and Writing CSVs
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module1/module1_31.html">
     Quick viz with Altair!
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module2.html">
   Module 2: Not So Scary Wrangling (Table Manipulation and Chaining)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-2" name="toctree-checkbox-2" type="checkbox"/>
  <label for="toctree-checkbox-2">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module2/module2_01.html">
     Reading in Different File Types
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module2/module2_06.html">
     Reading arguments
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module2/module2_09.html">
     Column renaming and column dropping
    </a>
   </li>
   <li class="toctree-l2">
    <a class="reference internal" href="../module2/module2_13.html">
     Column arithmetic and creation
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module3.html">
   Module 3: Tidy Data and Joining Dataframes
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-3" name="toctree-checkbox-3" type="checkbox"/>
  <label for="toctree-checkbox-3">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="module3_01.html">
     Tidy data
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module4.html">
   Module 4: Python Without the "Eek" (Basic Python)
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-4" name="toctree-checkbox-4" type="checkbox"/>
  <label for="toctree-checkbox-4">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module4/module4_01.html">
     Python data types
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module5.html">
   Module 5: Making Choices and Repeating Iterations
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-5" name="toctree-checkbox-5" type="checkbox"/>
  <label for="toctree-checkbox-5">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module5/module5_01.html">
     Making choices with conditional statements
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module6.html">
   Module 6: Functions Fundamentals and Best Practices
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-6" name="toctree-checkbox-6" type="checkbox"/>
  <label for="toctree-checkbox-6">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module6/module6_01.html">
     DRY revisited and function fundamentals
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module7.html">
   Module 7: Importing Files and the Coding Style Guide
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-7" name="toctree-checkbox-7" type="checkbox"/>
  <label for="toctree-checkbox-7">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module7/module7_01.html">
     Importing Python Libraries
    </a>
   </li>
  </ul>
 </li>
 <li class="toctree-l1 has-children">
  <a class="reference internal" href="../module8.html">
   Module 8: A Slice of NumPy and Advanced Data Wrangling
  </a>
  <input class="toctree-checkbox" id="toctree-checkbox-8" name="toctree-checkbox-8" type="checkbox"/>
  <label for="toctree-checkbox-8">
   <i class="fas fa-chevron-down">
   </i>
  </label>
  <ul>
   <li class="toctree-l2">
    <a class="reference internal" href="../module8/module8_01.html">
     NumPy and 1D Arrays
    </a>
   </li>
  </ul>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="../../_sources/modules/module3/module3_11.md"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.md</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Connect with source repository"><i class="fab fa-github"></i></button>
    <div class="dropdown-buttons sourcebuttons">
        <a class="repository-button"
            href="https://github.com/UBC-MDS/PPDS_book"><button type="button" class="btn btn-secondary topbarbtn"
                data-toggle="tooltip" data-placement="left" title="Source repository"><i
                    class="fab fa-github"></i>repository</button></a>
        <a class="issues-button"
            href="https://github.com/UBC-MDS/PPDS_book/issues/new?title=Issue%20on%20page%20%2Fmodules/module3/module3_11.html&body=Your%20issue%20content%20here."><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Open an issue"><i class="fas fa-lightbulb"></i>open issue</button></a>
        <a class="edit-button" href="https://github.com/UBC-MDS/PPDS_book/edit/main/modules/module3/module3_11.md"><button
                type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip" data-placement="left"
                title="Edit this page"><i class="fas fa-pencil-alt"></i>suggest edit</button></a>
    </div>
</div>

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#">
   Reshaping with pivot_table
  </a>
  <ul class="visible nav section-nav flex-column">
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#pivot-table">
     Pivot Table
    </a>
   </li>
   <li class="toc-h2 nav-item toc-entry">
    <a class="reference internal nav-link" href="#why-use-pivot-at-all-then">
     Why use pivot at all then?
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h1 nav-item toc-entry">
  <a class="reference internal nav-link" href="#lets-apply-what-we-learned">
   Let’s apply what we learned!
  </a>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="section" id="reshaping-with-pivot-table">
<h1>Reshaping with pivot_table<a class="headerlink" href="#reshaping-with-pivot-table" title="Permalink to this headline">¶</a></h1>
<p>Notes: <br></p>
<hr class="docutils" />
<div class="section" id="pivot-table">
<h2>Pivot Table<a class="headerlink" href="#pivot-table" title="Permalink to this headline">¶</a></h2>
<p><br> <br></p>
<center>
<a class="reference internal image-reference" href="module3/piv_cereal3.png"><img alt="module3/piv_cereal3.png" src="module3/piv_cereal3.png" style="width: 100%;" /></a>
</center>
<p>Notes:</p>
<p>We discussed that one of the effects of using <code class="docutils literal notranslate"><span class="pre">.pivot()</span></code> on our
<code class="docutils literal notranslate"><span class="pre">cereal_long</span></code> dataframe was that the new dataframe was missing the
column <code class="docutils literal notranslate"><span class="pre">mfr</span></code>.</p>
<p>That’s because <code class="docutils literal notranslate"><span class="pre">.pivot()</span></code> discards any columns that are not being
directly affected by the pivot. Only the column that is specified in the
index argument and the columns that need to be transformed are present
in the new dataframe.</p>
<p>That’s where <code class="docutils literal notranslate"><span class="pre">pivot_table</span></code> steps in!</p>
<hr class="docutils" />
<p><br> <br></p>
<center>
<a class="reference internal image-reference" href="module3/piv_table_cereal.png"><img alt="module3/piv_table_cereal.png" src="module3/piv_table_cereal.png" style="width: 100%;" /></a>
</center>
<p>Notes:</p>
<p><code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code> has the same arguments as <code class="docutils literal notranslate"><span class="pre">.pivot()</span></code> but the biggest
difference is that it allows us to include multiple columns under the
<code class="docutils literal notranslate"><span class="pre">index</span></code> argument. That just means we can keep any of the columns that
are not directly affected by the pivot.</p>
<p>Let’s try to convert our dataframe again but this time keeping the <code class="docutils literal notranslate"><span class="pre">mfr</span></code>
column with <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code>.</p>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_long</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>          name mfr nutrition  value
0    Special K   K  calories    110
1    Special K   K   protein      6
2  Apple Jacks   K  calories    110
3  Apple Jacks   K   protein      2
4  Raisin Bran   K  calories    120
5  Raisin Bran   K   protein      3
6     Cheerios   G  calories    110
7     Cheerios   G   protein      6
8     Wheaties   G  calories    100
9     Wheaties   G   protein      3
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_wider</span> <span class="o">=</span> <span class="n">cereal_long</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;mfr&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;nutrition&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">cereal_wider</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>nutrition        calories  protein
name        mfr                   
Apple Jacks K         110        2
Cheerios    G         110        6
Raisin Bran K         120        3
Special K   K         110        6
Wheaties    G         100        3
</pre></div>
</div>
<p>Notes:</p>
<p>Here is our long dataframe.</p>
<p>We include any columns that we wish to keep under the <code class="docutils literal notranslate"><span class="pre">index</span></code> argument
contained in square brackets.</p>
<p>We can see here, that our transformed dataframe now has the <code class="docutils literal notranslate"><span class="pre">mfr</span></code> column
as well as the new <code class="docutils literal notranslate"><span class="pre">calories</span></code> and <code class="docutils literal notranslate"><span class="pre">protein</span></code> column.</p>
<p>We still don’t have our index of containing integers though so we will
have to do something about that.</p>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_wider</span> <span class="o">=</span> <span class="n">cereal_long</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span><span class="s1">&#39;mfr&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;nutrition&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">cereal_wider</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>nutrition        calories  protein
name        mfr                   
Apple Jacks K         110        2
Cheerios    G         110        6
Raisin Bran K         120        3
Special K   K         110        6
Wheaties    G         100        3
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_wider</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span><span class="o">.</span><span class="n">rename_axis</span><span class="p">(</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="s1">&#39;columns&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>          name mfr  calories  protein
0  Apple Jacks   K       110        2
1     Cheerios   G       110        6
2  Raisin Bran   K       120        3
3    Special K   K       110        6
4     Wheaties   G       100        3
</pre></div>
</div>
<p>Notes:</p>
<p>And just like before, if we want to return to our original dataframe
with a column of numbers for our index, we use <code class="docutils literal notranslate"><span class="pre">.reset_index()</span></code> and
<code class="docutils literal notranslate"><span class="pre">rename_axis()</span></code> to clean up the index label.</p>
<hr class="docutils" />
<p><br> <br></p>
<center>
<a class="reference internal image-reference" href="module3/piv_table_cereal.png"><img alt="module3/piv_table_cereal.png" src="module3/piv_table_cereal.png" style="width: 100%;" /></a>
</center>
<p>Notes: Here we can see the same thing happened as before with <code class="docutils literal notranslate"><span class="pre">.pivot()</span></code>
but now we’ve kept the <code class="docutils literal notranslate"><span class="pre">mfr</span></code> column.</p>
</div>
<hr class="docutils" />
<div class="section" id="why-use-pivot-at-all-then">
<h2>Why use pivot at all then?<a class="headerlink" href="#why-use-pivot-at-all-then" title="Permalink to this headline">¶</a></h2>
<p><br> <br></p>
<center>
<a class="reference internal image-reference" href="module3/problem_table.png"><img alt="module3/problem_table.png" src="module3/problem_table.png" style="width: 80%;" /></a>
</center>
<p>Notes:</p>
<p>When we use <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code>, we have to proceed with caution.</p>
<p>We talked about how <code class="docutils literal notranslate"><span class="pre">.pivot()</span></code> and <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code> take the arguments
<code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code>. What happens if we have multiple rows with the
same <code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">column</span></code> values?</p>
<p>Take the following example where we see that Special K has 2 rows with
differing values for <code class="docutils literal notranslate"><span class="pre">calories</span></code>.</p>
<p>What happens when we try to pivot this?</p>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_problem</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>          name mfr nutrition  value
0    Special K   K  calories    100
1    Special K   K  calories    130
2    Special K   K   protein      6
3  Apple Jacks   K  calories    110
4  Apple Jacks   K   protein      2
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_problem</span><span class="o">.</span><span class="n">pivot</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;nutrition&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>ValueError: Index contains duplicate entries, cannot reshape

Detailed traceback: 
  File &quot;&lt;string&gt;&quot;, line 1, in &lt;module&gt;
  File &quot;/usr/local/lib/python3.7/site-packages/pandas/core/frame.py&quot;, line 5923, in pivot
    return pivot(self, index=index, columns=columns, values=values)
  File &quot;/usr/local/lib/python3.7/site-packages/pandas/core/reshape/pivot.py&quot;, line 450, in pivot
    return indexed.unstack(columns)
  File &quot;/usr/local/lib/python3.7/site-packages/pandas/core/series.py&quot;, line 3550, in unstack
    return unstack(self, level, fill_value)
  File &quot;/usr/local/lib/python3.7/site-packages/pandas/core/reshape/reshape.py&quot;, line 179, in _make_selectors
    raise ValueError(&quot;Index contains duplicate entries, cannot reshape&quot;)
</pre></div>
</div>
<p>Notes:</p>
<p>Here is our dataframe, and here is what happens when we use the same
arguments as before.</p>
<p><code class="docutils literal notranslate"><span class="pre">.pivot()</span></code> throws an error message.</p>
<hr class="docutils" />
<p><br> <br></p>
<center>
<a class="reference internal image-reference" href="module3/problem_pivot.png"><img alt="module3/problem_pivot.png" src="module3/problem_pivot.png" style="width: 100%;" /></a>
</center>
<p><em>Attribution: Nikolay Grozev,
<a href=" https://nikgrozev.com/2015/07/01/reshaping-in-pandas-pivot-pivot-table-stack-and-unstack-explained-with-pictures/" target="_blank">Reshaping
in Pandas - Pivot, Pivot-Table, Stack, and Unstack explained with
Pictures</a></em></p>
<p>Notes:</p>
<p>This is a useful error message, letting us know that there are
“duplicate entries, cannot reshape” which means there are non-unique
rows. We will need to do something before going any further.</p>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_problem</span><span class="o">.</span><span class="n">pivot_table</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;mfr&#39;</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="s1">&#39;nutrition&#39;</span><span class="p">,</span> <span class="n">values</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>nutrition        calories  protein
name        mfr                   
Apple Jacks K         110        2
Special K   K         115        6
</pre></div>
</div>
<p><br> <br></p>
<center>
<a class="reference internal image-reference" href="module3/problem_pivot_table.png"><img alt="module3/problem_pivot_table.png" src="module3/problem_pivot_table.png" style="width: 100%;" /></a>
</center>
<p>Notes:</p>
<p>Let’s see what happens when we use <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code>.</p>
<p>Ok, that’s odd. We don’t get an error this time but instead get a
<code class="docutils literal notranslate"><span class="pre">calories</span></code> value of 115 which is neither of the original values of 130
or 100.</p>
<p><code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code> instead by default takes the average of the duplicated
columns and continues to execute.</p>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_problem</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;nutrition&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>0     True
1     True
2    False
3    False
4    False
dtype: bool
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_problem</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;nutrition&#39;</span><span class="p">])</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>0    False
1     True
2    False
3    False
4    False
dtype: bool
</pre></div>
</div>
<p>Notes:</p>
<p>When we use <code class="docutils literal notranslate"><span class="pre">.pivot_table()</span></code>, we recommend checking if there are
duplicate values in columns we use in the <code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code>
arguments before we proceed.</p>
<p>We can do this with the <code class="docutils literal notranslate"><span class="pre">.duplicated()</span></code> verb. We put the columns we
specified in the <code class="docutils literal notranslate"><span class="pre">index</span></code> and <code class="docutils literal notranslate"><span class="pre">columns</span></code> arguments in a <code class="docutils literal notranslate"><span class="pre">subset</span></code> argument,
in this case, the columns <code class="docutils literal notranslate"><span class="pre">name</span></code> and <code class="docutils literal notranslate"><span class="pre">nutrition</span></code>. We set the argument
<code class="docutils literal notranslate"><span class="pre">keep</span></code> to <code class="docutils literal notranslate"><span class="pre">False</span></code> to make sure all the rows are identified and not just
the repeated ones.</p>
<p>Here we can see now that index 0 and 1 are both duplicates by the <code class="docutils literal notranslate"><span class="pre">True</span></code>
values.</p>
<p>Without the <code class="docutils literal notranslate"><span class="pre">keep</span></code> argument, only the index labeled <code class="docutils literal notranslate"><span class="pre">1</span></code> will be
identified as a duplicate.</p>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_problem</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;nutrition&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>0     True
1     True
2    False
3    False
4    False
dtype: bool
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">duplicate_info</span> <span class="o">=</span><span class="n">cereal_problem</span><span class="o">.</span><span class="n">duplicated</span><span class="p">(</span><span class="n">subset</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;nutrition&#39;</span><span class="p">],</span> <span class="n">keep</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">cereal_problem</span><span class="p">[</span><span class="n">duplicate_info</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>        name mfr nutrition  value
0  Special K   K  calories    100
1  Special K   K  calories    130
</pre></div>
</div>
<p>Notes:</p>
<p>We can obtain the duplicated rows by filtering them from the original
dataframe <code class="docutils literal notranslate"><span class="pre">cereal_problem</span></code>.</p>
<p>How we see our 2 rows with calorie values of 100 and 130.</p>
<hr class="docutils" />
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_problem</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>          name mfr nutrition  value
0    Special K   K  calories    100
1    Special K   K  calories    130
2    Special K   K   protein      6
3  Apple Jacks   K  calories    110
4  Apple Jacks   K   protein      2
</pre></div>
</div>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">cereal_no_problem</span> <span class="o">=</span> <span class="n">cereal_problem</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">cereal_no_problem</span>
</pre></div>
</div>
<div class="highlight-out notranslate"><div class="highlight"><pre><span></span>          name mfr nutrition  value
0    Special K   K  calories    100
2    Special K   K   protein      6
3  Apple Jacks   K  calories    110
4  Apple Jacks   K   protein      2
</pre></div>
</div>
<p>Notes:</p>
<p>Once we have decided which row we want to keep, we can use <code class="docutils literal notranslate"><span class="pre">.drop()</span></code>
that we learned in the previous Module to remove it from our original
dataframe.</p>
<p>For this example, we are going to drop the row at index 1, which has a
calorie value of 130.</p>
<p>We use the argument <code class="docutils literal notranslate"><span class="pre">axis=0,</span></code> which refers to the rows in the dataframe
and <code class="docutils literal notranslate"><span class="pre">index,</span></code> which specifies the row index that we want to drop.</p>
<p>This just means we are <em>“dropping a row with index 1”</em>.</p>
</div>
</div>
<hr class="docutils" />
<div class="section" id="lets-apply-what-we-learned">
<h1>Let’s apply what we learned!<a class="headerlink" href="#lets-apply-what-we-learned" title="Permalink to this headline">¶</a></h1>
<p>Notes: <br></p>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "UBC-MDS/PPDS_book",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./modules/module3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    

</div>
        
        </div>
    </div>
    <footer class="footer mt-5 mt-md-0">
    <div class="container">
      <p>
        
          By Hayley Boyce, Mike Gelbart, Tiffany Timbers<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="../../_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>